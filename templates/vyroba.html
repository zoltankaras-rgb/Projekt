<!DOCTYPE html>
<html lang="sk">
<head>
  <!-- Inline favicon (žiadne 404) -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2032%2032%22%3E%3Ccircle%20cx%3D%2216%22%20cy%3D%2216%22%20r%3D%2214%22/%3E%3C/svg%3E" />
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modul Výroba</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <style>
    :root {
      --primary-color:#3b82f6; --primary-hover:#2563eb; --secondary-color:#6b7280; --secondary-hover:#4b5563;
      --success-color:#16a34a; --warning-color:#f59e0b; --danger-color:#ef4444; --danger-hover:#dc2626;
      --light-gray:#f3f4f6; --medium-gray:#e5e7eb; --dark-gray:#374151; --font-family:'Inter',sans-serif;
      --border-radius:.5rem; --shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    body { font-family:var(--font-family); background:var(--light-gray); color:var(--dark-gray);
           margin:0; padding:2rem; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
    .app-container, .login-container { width:100%; max-width:800px; background:#fff; border-radius:var(--border-radius);
      box-shadow:var(--shadow); overflow:hidden; }
    .app-header { background:var(--primary-color); color:#fff; padding:1.5rem; }
    .app-header h1 { margin:0; font-size:1.75rem; font-weight:700; }
    .app-header p { margin:.25rem 0 0; opacity:.8; }
    .app-content { padding:1.5rem; }
    .login-container { max-width:400px; padding:2.5rem; margin-top:5rem; }
    .login-container h2 { text-align:center; margin-top:0; }
    .hidden { display:none !important; }
    .view { display:none; }
    .section { background:#fff; padding:1.5rem; border:1px solid var(--medium-gray);
               border-radius:var(--border-radius); margin-bottom:1.5rem; }
    h3 { text-align:center; font-size:1.25rem; margin:0 0 1.5rem; padding-bottom:.75rem; border-bottom:1px solid var(--medium-gray); }
    h4 { margin:1.5rem 0 1rem; }
    label { display:block; margin-top:1rem; font-weight:500; font-size:.875rem; margin-bottom:.25rem; }
    input, select, textarea { width:100%; padding:.75rem; margin-top:.25rem; border-radius:.375rem; border:1px solid var(--medium-gray);
      box-sizing:border-box; font-family:inherit; }
    button { width:100%; padding:.75rem 1rem; color:#fff; border:none; border-radius:.375rem; cursor:pointer; font-size:.9rem;
      margin-top:1.25rem; font-weight:600; transition:background-color .2s; }
    .btn-primary { background:var(--primary-color); } .btn-primary:hover { background:var(--primary-hover); }
    .btn-info { background:#0ea5e9; } .btn-info:hover { background:#0284c7; }
    .btn-secondary { background:var(--secondary-color); }
    .btn-warning { background:var(--warning-color); }
    .btn-danger { background:var(--danger-color); } .btn-danger:hover { background:var(--danger-hover); }
    .btn-grid { display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
    #status { padding:12px; border-radius:5px; text-align:center; display:none; margin-top:1rem; }
    .success { background:#d1fae5; color:#065f46; } .error { background:#fee2e2; color:#991b1b; }
    .table-container { max-height:400px; overflow-y:auto; border:1px solid var(--medium-gray); border-radius:var(--border-radius); }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:.75rem 1rem; text-align:left; border-bottom:1px solid var(--medium-gray); }
    th { background:var(--light-gray); font-weight:600; position:sticky; top:0; }
    .loss { color:var(--danger-color); font-weight:bold; }
    ul { padding-left:20px; }
  </style>
</head>
<body>

  <!-- LOGIN WRAPPERS ktoré používa common.js -->
  <div id="login">
    <div id="login-wrapper">
      <div id="login-container" class="login-container">
        <h2><i class="fas fa-cogs"></i> Modul Výroba</h2>
        <form id="login-form">
          <div class="form-group">
            <label for="username">Používateľské meno:</label>
            <input id="username" type="text" required autocomplete="username"/>
          </div>
          <div class="form-group">
            <label for="password">Heslo:</label>
            <input id="password" type="password" required autocomplete="current-password"/>
          </div>
          <button type="submit" class="btn-primary">Prihlásiť sa</button>
        </form>
        <div id="status"></div>
      </div>
    </div>
  </div>

  <!-- APP WRAPPER: #app je VŽDY viditeľný; skrytý je iba #app-container (toto fixuje flicker->biela) -->
  <div id="app">
    <div id="app-container" class="app-container hidden">
      <header class="app-header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h1>Modul Výroba</h1>
            <p id="user-info">Vitajte, ...</p>
          </div>
          <button id="logout-button" class="btn-danger" style="width:auto; margin:0;">
            <i class="fas fa-sign-out-alt"></i> Odhlásiť sa
          </button>
        </div>
      </header>

      <main id="production-module-container" class="app-content">
        <!-- MENU -->
        <div id="view-production-menu" class="view">
          <div class="section">
            <h4 style="margin-top:0;">Prebiehajúce výroby</h4>
            <div id="running-tasks-container"></div>
            <h4 style="margin-top:20px;">Príkazy na Dnes</h4>
            <div id="production-tasks-container"></div>
          </div>
          <div class="section">
            <h3>Operácie</h3>
            <button class="btn-primary" onclick="showVyrobaView('view-start-production-category')">
              <i class="fas fa-play"></i> Spustiť novú výrobu
            </button>
            <div class="btn-grid">
              <button class="btn-info" onclick="loadAndShowStockLevels()"><i class="fas fa-boxes"></i> Prehľad Skladov</button>
              <button class="btn-warning" onclick="loadAndShowInventory()"><i class="fas fa-clipboard-check"></i> Inventúra</button>
            </div>
            <button class="btn-danger" onclick="loadAndShowManualWriteoff()"><i class="fas fa-minus-circle"></i> Manuálny Výdaj</button>
          </div>
        </div>

        <!-- KROK 1: KATEGÓRIA -->
        <div id="view-start-production-category" class="view">
          <div class="section">
            <h3>Krok 1: Zvoľte kategóriu</h3>
            <div id="category-container" class="btn-grid"></div>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-production-menu')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>

        <!-- KROK 2: PRODUKT -->
        <div id="view-start-production-product" class="view">
          <div class="section">
            <h3 id="product-selection-title">Krok 2: Zvoľte produkt</h3>
            <div id="product-container" class="btn-grid"></div>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-start-production-category')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>

        <!-- KROK 3: PLÁNOVANIE -->
        <div id="view-start-production-batch" class="view">
          <div class="section">
            <h3 id="batch-planning-title">Krok 3: Plánovanie</h3>
            <label for="production-date">Dátum výroby:</label>
            <input id="production-date" type="date"/>

            <label for="planned-weight">Plánované množstvo (kg):</label>
            <input id="planned-weight" type="number" min="1"
                   oninput="calculateIngredientsForBatch(this.dataset.productName, this.value)"/>

            <div id="ingredients-check-area" style="margin-top:20px; display:none;">
              <h4>Kontrola surovín</h4>
              <div id="ingredients-table" class="table-container"></div>
            </div>

            <button id="start-production-btn" class="btn-primary" onclick="startProduction()" disabled>
              <i class="fas fa-check"></i> Spustiť výrobu
            </button>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-start-production-product')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>

        <!-- SKLAD – PREHĽAD -->
        <div id="view-stock-levels" class="view">
          <div class="section">
            <h3>Stav Skladu Surovín</h3>
            <div id="stock-tables-container"></div>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-production-menu')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>

        <!-- SKLAD – INVENTÚRA -->
        <div id="view-inventory" class="view">
          <div class="section">
            <h3>Inventúra Surovín</h3>
            <p>Zadajte reálny stav len pre položky, ktoré chcete upraviť.</p>
            <div id="inventory-tables-container"></div>
            <button class="btn-warning" onclick="submitInventory()"><i class="fas fa-save"></i> Potvrdiť a Zapísať</button>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-production-menu')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>

        <!-- SKLAD – MANUÁLNY VÝDAJ -->
        <div id="view-manual-writeoff" class="view">
          <div class="section">
            <h3>Manuálny Výdaj Surovín</h3>
            <label for="writeoff-worker-name">Vaše Meno:</label>
            <input id="writeoff-worker-name" type="text"/>
            <label for="writeoff-item-select">Surovina:</label>
            <select id="writeoff-item-select"></select>
            <label for="writeoff-quantity">Množstvo (kg):</label>
            <input id="writeoff-quantity" type="number" min="0.01" step="0.01"/>
            <label for="writeoff-note">Poznámka (dôvod výdaja):</label>
            <textarea id="writeoff-note" rows="3"></textarea>
            <button class="btn-danger" onclick="submitManualWriteoff()"><i class="fas fa-check-circle"></i> Potvrdiť Výdaj</button>
          </div>
          <button class="btn-secondary" onclick="showVyrobaView('view-production-menu')">
            <i class="fas fa-arrow-left"></i> Späť
          </button>
        </div>
      </main>
    </div>
  </div>

  <!-- Skripty: najprv common.js (session/login), potom vyroba.js -->
  <script src="/static/js/common.js"></script>
  <script src="/static/js/vyroba.js"></script>
</body>
</html>
