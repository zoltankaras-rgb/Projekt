<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modul Expedícia</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    :root {
      --primary-color:#f59e0b; --primary-hover:#d97706; --secondary-color:#6b7280;
      --success-color:#16a34a; --warning-color:#f59e0b; --danger-color:#ef4444;
      --light-gray:#f3f4f6; --medium-gray:#e5e7eb; --dark-gray:#374151; --font-family:'Inter',sans-serif;
      --border-radius:.5rem; --shadow:0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);
    }
    body{font-family:var(--font-family);background:var(--light-gray);color:var(--dark-gray);margin:0;padding:2rem;display:flex;justify-content:center;align-items:flex-start;min-height:100vh}
    .app-container,.login-container{width:100%;max-width:960px;background:#fff;border-radius:var(--border-radius);box-shadow:var(--shadow);overflow:hidden}
    .app-header{background:var(--primary-color);color:#fff;padding:1.5rem}
    .app-header h1{margin:0;font-size:1.75rem;font-weight:700}
    .app-header p{margin:.25rem 0 0;opacity:.8}
    .app-content{padding:1.5rem}
    .login-container{max-width:400px;padding:2.5rem;margin-top:5rem}
    .login-container h2{text-align:center;margin-top:0}
    .hidden{display:none !important}
    .view{display:none}
    .section{background:#fff;padding:1.5rem;border:1px solid var(--medium-gray);border-radius:var(--border-radius);margin-bottom:1.5rem}
    h3{text-align:center;font-size:1.25rem;margin:0 0 1.5rem;padding-bottom:.75rem;border-bottom:1px solid var(--medium-gray)}
    h4{margin:1.5rem 0 1rem}
    label{display:block;margin-top:1rem;font-weight:500;font-size:.875rem;margin-bottom:.25rem}
    input,select,textarea{width:100%;padding:.75rem;margin-top:.25rem;border-radius:.375rem;border:1px solid var(--medium-gray);box-sizing:border-box;font-family:inherit}
    button{width:100%;padding:.75rem 1rem;color:#fff;border:none;border-radius:.375rem;cursor:pointer;font-size:.9rem;margin-top:1.25rem;font-weight:600;transition:background-color .2s}
    .btn-primary{background:#f59e0b}.btn-primary:hover{background:#d97706}
    .btn-success{background:#16a34a}.btn-danger{background:#ef4444}.btn-info{background:#0ea5e9}.btn-secondary{background:#6b7280}.btn-warning{background:#f59e0b}
    .btn-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.75rem}
    .table-container{max-height:420px;overflow-y:auto;border:1px solid var(--medium-gray);border-radius:var(--border-radius)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.75rem 1rem;text-align:left;border-bottom:1px solid var(--medium-gray)}
    th{background:var(--light-gray);font-weight:600;position:sticky;top:0}
    #scanner-container{width:100%;max-width:520px;margin:auto;border:2px solid var(--medium-gray);border-radius:var(--border-radius)}
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login-wrapper" class="login-container">
    <h2><i class="fas fa-boxes-stacked"></i> Modul Expedícia</h2>
    <form id="login-form">
      <div class="form-group"><label for="username">Používateľské meno:</label><input type="text" id="username" required autocomplete="username"></div>
      <div class="form-group"><label for="password">Heslo:</label><input type="password" id="password" required autocomplete="current-password"></div>
      <button type="submit" class="btn-primary">Prihlásiť sa</button>
    </form>
    <div id="status"></div>
  </div>

  <!-- APP -->
  <div id="app-container" class="app-container hidden">
    <header class="app-header">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><h1>Modul Expedícia</h1><p id="user-info">Vitajte, ...</p></div>
        <button id="logout-button" class="btn-danger" style="width:auto;margin:0;"><i class="fas fa-sign-out-alt"></i> Odhlásiť sa</button>
      </div>
    </header>

    <main id="expedition-module-container" class="app-content">
      <!-- MENU -->
      <div id="view-expedition-menu" class="view">
        <div class="section">
          <h3>Hlavné Menu</h3>
          <div class="btn-grid">
            <button class="btn-primary" onclick="loadProductionDates()"><i class="fas fa-dolly"></i> Prevziať zo Výroby</button>
            <button class="btn-warning" onclick="loadAndShowProductInventory()"><i class="fas fa-clipboard-check"></i> Inventúra</button>
            <button class="btn-success" onclick="loadAndShowManualReceive()"><i class="fas fa-plus-square"></i> Manuálny Príjem</button>
            <button class="btn-info" onclick="loadAndShowSlicingRequest()"><i class="fas fa-cut"></i> Požiadavka Krájanie</button>
            <button class="btn-secondary" onclick="startBarcodeScanner()"><i class="fas fa-barcode"></i> Skenovať Šaržu</button>
            <button class="btn-primary" onclick="openAcceptanceDays()"><i class="fas fa-folder-open"></i> Archív prijmu</button>
            <button class="btn-secondary" onclick="loadAndShowStockOverview()"><i class="fas fa-warehouse"></i> Skladové zásoby</button>
          </div>
        </div>
        <div class="section" id="slicing-section-container">
          <h4>Prebiehajúce Krájanie</h4>
          <div id="pending-slicing-container" class="table-container">Načítavam...</div>
        </div>
      </div>

      <!-- Výber dňa výroby -->
      <div id="view-expedition-date-selection" class="view">
        <div class="section">
          <h3>Krok 1: Zvoľte deň výroby</h3>
          <div id="expedition-date-container" class="btn-grid"></div>
        </div>
        <button class="btn-secondary" onclick="showExpeditionView('view-expedition-menu')"><i class="fas fa-arrow-left"></i> Späť</button>
      </div>

      <!-- Príjem po položkách -->
      <div id="view-expedition-batch-list" class="view">
        <div class="section">
          <h3 id="expedition-batch-list-title">Príjem výrobkov</h3>
          <div class="form-group" style="max-width:680px;display:grid;grid-template-columns:1fr 1fr;gap:.75rem;align-items:end">
            <div>
              <label for="expedition-worker-name">Meno preberajúceho:</label>
              <input type="text" id="expedition-worker-name">
            </div>
            <div>
              <label for="expedition-accept-date">Dátum prijmu (ak sa preberá neskôr):</label>
              <input type="date" id="expedition-accept-date">
            </div>
          </div>
          <div id="expedition-batch-table" class="table-container"></div>
          <div id="expedition-action-buttons" style="margin-top:1rem"></div>
        </div>
      </div>

      <!-- Archív – zoznam dní -->
      <div id="view-expedition-acceptance-days" class="view">
        <div class="section">
          <h3>Archív prijmu – dni</h3>
          <div id="acceptance-days-container" class="btn-grid"></div>
          <button class="btn-secondary" onclick="showExpeditionView('view-expedition-menu')"><i class="fas fa-arrow-left"></i> Späť</button>
        </div>
      </div>

      <!-- Archív – detail dňa -->
      <div id="view-expedition-acceptance-archive" class="view">
        <div class="section">
          <h3>Archív prijmov</h3>
          <div style="display:grid;grid-template-columns:1fr auto;gap:.75rem;align-items:end;max-width:460px">
            <div>
              <label for="accept-archive-date">Dátum:</label>
              <input type="date" id="accept-archive-date" onchange="loadAcceptanceArchive()">
            </div>
            <button class="btn-secondary" style="width:auto;margin:0" onclick="loadAcceptanceArchive()"><i class="fas fa-rotate"></i> Obnoviť</button>
          </div>
          <div id="acceptance-archive-table" class="table-container" style="margin-top:1rem"></div>
          <div class="btn-grid">
            <button class="btn-secondary" onclick="openAcceptanceDays()"><i class="fas fa-arrow-left"></i> Späť na dni</button>
          </div>
        </div>
      </div>

      <!-- Skladové zásoby (Sklad 2) -->
      <div id="view-expedition-stock-overview" class="view">
        <div class="section">
          <h3>Skladové zásoby – Sklad 2</h3>
          <div id="stock-overview-tables-container"></div>
          <div class="btn-grid">
            <button class="btn-secondary" onclick="showExpeditionView('view-expedition-menu')"><i class="fas fa-arrow-left"></i> Späť</button>
          </div>
        </div>
      </div>

      <!-- Inventúra sklad 2 -->
      <div id="view-expedition-inventory" class="view">
        <div class="section">
          <h3>Inventúra Finálnych Produktov (Sklad 2)</h3>
          <p>Zadajte reálny stav len tam, kde sa líši od systému.</p>
          <label for="inventory-worker-name">Meno pracovníka:</label>
          <input type="text" id="inventory-worker-name">
          <div id="product-inventory-tables-container"></div>
          <button class="btn-warning" onclick="submitProductInventory()"><i class="fas fa-save"></i> Zapísať inventúru</button>
        </div>
      </div>

      <!-- Manuálny príjem -->
      <div id="view-expedition-manual-receive" class="view">
        <div class="section">
          <h3>Manuálny Príjem Výrobkov</h3>
          <label for="manual-receive-worker-name">Vaše Meno:</label><input type="text" id="manual-receive-worker-name">
          <label for="manual-receive-date">Dátum:</label><input type="date" id="manual-receive-date">
          <label for="manual-receive-product-select">Produkt:</label><select id="manual-receive-product-select"></select>
          <label for="manual-receive-quantity">Množstvo (ks/kg):</label><input type="number" id="manual-receive-quantity" min="1">
          <button class="btn-success" onclick="submitManualReceive()">Potvrdiť Príjem</button>
        </div>
      </div>

      <!-- Požiadavka krájanie -->
      <div id="view-expedition-slicing-request" class="view">
        <div class="section">
          <h3>Požiadavka na krájanie</h3>
          <label for="slicing-product-select">Finálny balíček:</label><select id="slicing-product-select"></select>
          <label for="slicing-planned-pieces">Plánovaný počet kusov:</label><input type="number" id="slicing-planned-pieces" min="1">
          <button class="btn-info" onclick="submitSlicingRequest()">Vytvoriť Požiadavku</button>
        </div>
      </div>

      <!-- Skenovanie šarže -->
      <div id="view-expedition-scanner" class="view">
        <div class="section">
          <h3>Skenovanie Šarže</h3>
          <div id="scanner-container"></div>
          <div id="scan-result" style="text-align:center;margin-top:1rem;font-weight:600"></div>
          <button class="btn-secondary" onclick="showExpeditionView('view-expedition-menu')"><i class="fas fa-arrow-left"></i> Späť na Menu</button>
        </div>
      </div>
    </main>
  </div>

  <script src="/static/js/common.js"></script>
  <script src="/static/js/expedicia.js"></script>
</body>
</html>
